let { addHistory, getHistory, clearHistory } = require('../model/chatbotHistory');

// Get response message generated by chatbot
// Used by [POST] localhost/api/chatbot/query
const getResponseText = async (req, res) => {
  // Get input string from user
  const { user_id, user_input } = req.body;

  try {
    // Validate input data
    // Code here ...

    // Send request to API server and get response
    // Code here ...

    // Validate response data and send corresponding error message
    // Code here ...

    // Store chat history to database (use function from imported model)
    // Code here ...
    // addHistory()

    // Return response to user
    return res.status(200).json({
      message: "Success",
      response_text: `Sample answer for "${user_input}" by user ${user_id}`
    });
  } catch (error) {
    console.error("Error logging in: ", error);
    return res.status(500).json({
      error: "Internal server error"
    })
  }
}

// Retrieve the saved chat history stored in database
// Used by [POST] localhost/api/chatbot/history
const getChatHistory = async (req, res) => {
  // Get input string from user
  const { user_id } = req.body;

  try {
    // Validate input data
    // Code here ...

    // Get data from database (use function from imported model)
    // Code here ...
    // getHistory()

    // Validate retrieved data and send corresponding error message
    // Code here ...

    // Return response to user
    return res.status(200).json({
      message: `Get history succesful for user ${user_id}`,
      chat_history: []
    });
  } catch (error) {
    console.error("Error logging in: ", error);
    return res.status(500).json({
      error: "Internal server error"
    })
  }
}

// Retrieve the saved chat history stored in database
// Used by [DELETE] localhost/api/chatbot/history
const clearChatHistory = async (req, res) => {
  // Get input string from user
  const { user_id } = req.body;

  try {
    // Validate input data
    // Code here ...

    // Delete data from database (use function from imported model)
    // Code here ...
    // clearHistory()

    // Validate retrieved data and send corresponding error message
    // Code here ...

    // Return response to user
    return res.status(200).json({
      message: `Clear history succesful for user ${user_id}`,
    });
  } catch (error) {
    console.error("Error logging in: ", error);
    return res.status(500).json({
      error: "Internal server error"
    })
  }
}

module.exports = {
  getResponseText,
  getChatHistory,
  clearChatHistory
}