openapi: 3.0.0
info:
  title: NutriHelp API
  version: 1.0.0
servers:
  - url: http://localhost/api
tags:
  - name: System
    description: System and security monitoringÂ endpoints
  - name: LoginDashboard
    description: KPIs and trends from public.audit_logs
  - name: Allergy
    description: Endpoints for allergy checks and warnings
  - name: Community
    description: Community features including posts, comments, and likes
paths:
  /allergy/common:
    get:
      tags: [Allergy]
      summary: Get common allergens list
      description: Returns an array of common allergens to help build UI pickers.
      responses:
        '200':
          description: List of common allergens
          content:
            application/json:
              schema:
                type: object
                properties:
                  allergens:
                    type: array
                    items: { type: string }
              examples:
                default:
                  value:
                    allergens: ["peanuts","tree nuts","milk","eggs","soy","wheat","fish","shellfish","sesame"]

  /allergy/check:
    post:
      tags: [Allergy]
      summary: Check a meal against user allergies
      description: Returns which of the user's allergies are present in the meal's ingredients.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AllergyCheckRequest'
            examples:
              simple:
                value:
                  userAllergies: ["peanuts","milk"]
                  meal:
                    name: "PB&J with milk"
                    ingredients: ["bread","peanut butter","jelly","milk"]
      responses:
        '200':
          description: Allergy check result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AllergyCheckResponse'


  /system/generate-baseline:
    post:
      tags:
        - System
      summary: Regenerate baseline hash data for file integrity checks
      description: Re-creates the baseline.json file to update file integrity data.
      responses:
        '200':
          description: Baseline regenerated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Baseline regenerated successfully
                  fileCount:
                    type: integer
                    example: 4
        '500':
          description: Server error while regenerating baseline
  /system/integrity-check:
    get:
      tags:
        - System
      summary: Run file integrity and anomaly check
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  anomalies:
                    type: array
                    items:
                      type: object
                      properties:
                        file:
                          type: string
                        issue:
                          type: string
  /login-dashboard/kpi:
    get:
      tags: [LoginDashboard]
      summary: 24h login KPIs
      responses:
        '200':
          description: KPIs
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Kpi24h' }
 
  /login-dashboard/daily:
    get:
      tags: [LoginDashboard]
      summary: Daily attempts/success/failure
      parameters:
        - in: query
          name: days
          schema: { type: integer, minimum: 1, default: 30 }
      responses:
        '200':
          description: Time series
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/DailyRow' }
 
  /login-dashboard/dau:
    get:
      tags: [LoginDashboard]
      summary: Daily Active Users (successful unique logins)
      parameters:
        - in: query
          name: days
          schema: { type: integer, minimum: 1, default: 30 }
      responses:
        '200':
          description: DAU time series
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/DauRow' }
 
  /login-dashboard/top-failing-ips:
    get:
      tags: [LoginDashboard]
      summary: Top failing IPs (7 days)
      responses:
        '200':
          description: Suspicious IPs
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/FailingIpRow' }
 
  /login-dashboard/fail-by-domain:
    get:
      tags: [LoginDashboard]
      summary: Failures grouped by email domain (7 days)
      responses:
        '200':
          description: Failure counts by domain
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/DomainFailRow' }
  /upload:
    post:
      summary: Upload a file
      description: Upload JPG, PNG, or PDF (max 5MB, limited to 5 uploads per 10 minutes)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: File uploaded successfully
        '400':
          description: Upload failed due to size/type restriction
        '429':
          description: Too many uploads from this IP (rate limit exceeded)
  /appointments:
    post:
      summary: Save appointment data
        /upload:
          post:
            summary: Upload a file
            description: Upload JPG, PNG, or PDF (max 5MB, limited to 5 uploads per 10 minutes)
            security:
              - BearerAuth: []
            requestBody:
              required: true
              content:
                multipart/form-data:
                  schema:
                    type: object
                    properties:
                      file:
                        type: string
                        format: binary
            responses:
              '200':
                description: File uploaded successfully
              '400':
                description: Upload failed due to size/type restriction
              '429':
                description: Too many uploads from this IP (rate limit exceeded)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Appointment'
      responses:
        '201':
          description: Appointment saved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Bad request - missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Shopping List API Endpoints
  /shopping-list/ingredient-options:
    get:
      tags:
        - Shopping List
      summary: Search ingredients by name
      description: Search ingredients by name and return price, store, and package information
      parameters:
        - name: name
          in: query
          required: true
          description: Ingredient name for search (supports partial matching)
          schema:
            type: string
            minLength: 1
            maxLength: 100
            example: "Tomato"
      responses:
        '200':
          description: Ingredient options retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: "success"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/IngredientOption'
        '400':
          description: Bad request - missing ingredient name
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /shopping-list/from-meal-plan:
    post:
      tags:
        - Shopping List
      summary: Generate shopping list from meal plan
      description: Merge ingredient needs from selected meals and return aggregated quantities
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
                - meal_plan_ids
              properties:
                user_id:
                  type: integer
                  description: User ID
                  example: 123
                meal_plan_ids:
                  type: array
                  description: Array of meal plan IDs
                  items:
                    type: integer
                  example: [1, 2, 3]
                meal_types:
                  type: array
                  description: Array of meal types (optional)
                  items:
                    type: string
                  example: ["breakfast", "lunch", "dinner"]
      responses:
        '200':
          description: Shopping list generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: "success"
                  data:
                    $ref: '#/components/schemas/ShoppingListFromMealPlan'
        '400':
          description: Bad request - missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: No meal plans found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /shopping-list:
    post:
      tags:
        - Shopping List
      summary: Create shopping list
      description: Store shopping lists for logged-in users in the database
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
                - name
                - items
              properties:
                user_id:
                  type: integer
                  description: User ID
                  example: 123
                name:
                  type: string
                  description: Shopping list name
                  maxLength: 255
                  example: "Weekly Shopping List"
                items:
                  type: array
                  description: Array of shopping list items
                  items:
                    $ref: '#/components/schemas/ShoppingListItemInput'
                estimated_total_cost:
                  type: number
                  format: float
                  description: Estimated total cost
                  example: 45.67
      responses:
        '201':
          description: Shopping list created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                    example: 201
                  message:
                    type: string
                    example: "success"
                  data:
                    type: object
                    properties:
                      shopping_list:
                        $ref: '#/components/schemas/ShoppingList'
                      items:
                        type: array
                        items:
                          $ref: '#/components/schemas/ShoppingListItem'
        '400':
          description: Bad request - missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      tags:
        - Shopping List
      summary: Get shopping lists
      description: Retrieve shopping lists for logged-in users
      parameters:
        - name: user_id
          in: query
          required: true
          description: User ID to get shopping lists for
          schema:
            type: integer
            example: 123
      responses:
        '200':
          description: Shopping lists retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: "success"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ShoppingListWithProgress'
        '400':
          description: Bad request - missing user ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /shopping-list/items/{id}:
    patch:
      tags:
        - Shopping List
      summary: Update shopping list item
      description: Update item status (purchased, quantity, notes)
      parameters:
        - name: id
          in: path
          required: true
          description: Shopping list item ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                purchased:
                  type: boolean
                  description: Whether the item has been purchased
                  example: true
                quantity:
                  type: number
                  format: float
                  description: Updated quantity
                  minimum: 0.01
                  example: 600
                notes:
                  type: string
                  description: Updated notes
                  maxLength: 1000
                  example: "Updated notes"
      responses:
        '200':
          description: Item updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: "success"
                  data:
                    $ref: '#/components/schemas/ShoppingListItem'
        '400':
          description: Bad request - invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Shopping List
      summary: Delete shopping list item
      description: Remove item from shopping list
      parameters:
        - name: id
          in: path
          required: true
          description: Shopping list item ID
          schema:
            type: integer
            example: 1
      responses:
        '204':
          description: Item deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  statusCode:
                    type: integer
                    example: 204
                  message:
                    type: string
                    example: "success"
        '400':
          description: Bad request - invalid item ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    get:
      summary: Retrieve all appointment data
      description: Returns a JSON array containing all appointments
      responses:
        '200':
          description: Appointments fetched successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Appointment'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /contactus:
    post:
      summary: Contact us
      description: Receives a contact request
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContactRequest'
      responses:
        '201':
          description: Data received successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Bad request - missing required fields
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /fooddata/dietaryrequirements:
    get:
      summary: Get dietary requirements
      description: Retrieves a list of dietary requirements
      responses:
        '200':
          description: List of dietary requirements
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IDNamePair'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /fooddata/cuisines:
    get:
      summary: Get cuisines
      description: Retrieves a list of cuisines
      responses:
        '200':
          description: List of cuisines
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IDNamePair'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /fooddata/allergies:
    get:
      summary: Get allergies
      description: Retrieves a list of allergies
      responses:
        '200':
          description: List of allergies
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IDNamePair'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /fooddata/ingredients:
    get:
      summary: Get ingredients
      description: Retrieves a list of ingredients (name and ID only)
      responses:
        '200':
          description: List of ingredients
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IDNamePair'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /fooddata/cookingmethods:
    get:
      summary: Get cooking methods
      description: Retrieves a list of cooking methods
      responses:
        '200':
          description: List of cooking methods
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IDNamePair'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /system/test-error/trigger:
    post:
      tags:
        - System
      summary: Trigger a simulated error for testing error logging
      description: |-
        This endpoint intentionally triggers an error so you can test the error logging middleware and verify entries are written to the Supabase `error_logs` table.
        Use the `simulate` field in the request body to choose the behavior: `throw` (synchronous throw), `next` (pass to next), or omit for a delayed async error.
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                simulate:
                  type: string
                  example: throw
                  description: 'Options: "throw", "next" or omitted (delayed error)'
      responses:
        '200':
          description: If the request unexpectedly succeeds
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Triggered error (this should not be returned)
        '500':
          description: Error triggered and handled by error logging middleware
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /fooddata/spicelevels:
    get:
      summary: Get spice levels
      description: Retrieves a list of spice levels
      responses:
        '200':
          description: List of spice levels
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IDNamePair'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /fooddata/healthconditions:
    get:
      summary: Get health conditions
      description: Retrieves a list of health conditions
      responses:
        '200':
          description: List of health conditions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IDNamePair'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /imageClassification:
    post:
      summary: Image classification
      description: Receives an image and classifies it
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
      responses:
        '200':
          description: Image classified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  prediction:
                    type: string
                    example: "Avocado:~160 calories per 100 grams"
        '400':
          description: Bad request - missing image
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /recipeImageClassification:
    post:
      summary: Recipe image classification
      description: Receives an image of a recipe and classifies it
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
      responses:
        '200':
          description: Image classified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  prediction:
                    type: string
                    example: "Lasagna"
        '400':
          description: Bad request - missing image
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /login:
    post:
      summary: User login
      description: Authenticates user and returns a JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful, JWT token returned
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    $ref: '#/components/schemas/JWTResponse'
                  user:
                    $ref: '#/components/schemas/UserResponse'
        '400':
          description: Email and password are required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Invalid email or password
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /login/mfa:
    post:
      summary: Multi-factor authentication
      description: Authenticates user with multi-factor authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginWithMFARequest'
      responses:
        '200':
          description: MFA successful, JWT token returned
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    $ref: '#/components/schemas/JWTResponse'
                  user:
                    $ref: '#/components/schemas/UserResponse'
        '400':
          description: Email and password are required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Invalid email or password
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /mealplan:
    get:
      summary: Get meal plan
      description: Retrieves a meal plan for the user
      security:
        - BearerAuth: [ ]
      # TODO should not use requestBody for GET
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: integer
                user_id:
                  type: integer
      responses:
        '200':
          description: Meal plan fetched successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateMealPlanRequest'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      summary: Save meal plan
      description: Receives a meal plan and saves it
      security:
       - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MealPlanResponse'
      responses:
        '201':
          description: Meal plan saved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Bad request - missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: Delete meal plan
      description: Deletes the user's meal plan
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: integer
                user_id:
                  type: integer
      responses:
        '204':
          description: Meal plan deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Bad request - missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /recipe:
    post:
      summary: Get all recipes
      description: Retrieves recipes for a given user ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: integer
      responses:
        '200':
          description: Recipe fetched successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  recipes:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        created_at:
                          type: string
                        recipe_name:
                          type: string
                        cuisine_id:
                          type: integer
                        total_servings:
                          type: integer
                        preparation_time:
                          type: integer
                        ingredients:
                          type: object
                          properties:
                            id:
                              type: array
                              items:
                                type: integer
                            quantity:
                              type: array
                              items:
                                type: integer
                            category:
                              type: array
                              items:
                                type: string
                            name:
                              type: array
                              items:
                                type: string
                        instructions:
                          type: string
                        calories:
                          type: number
                        fat:
                          type: number
                        carbohydrates:
                          type: number
                        protein:
                          type: number
                        fiber:
                          type: number
                        vitamin_a:
                          type: number
                        vitamin_b:
                          type: number
                        vitamin_c:
                          type: number
                        vitamin_d:
                          type: number
                        sodium:
                          type: number
                        sugar:
                          type: number
                        cuisine_name:
                          type: string

        '400':
          description: User ID is required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Recipes, ingredients, or cuisines not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /signup:
    post:
      summary: User signup
      description: Registers a new user with an email and password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignupRequest'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Bad request - either missing email/password or user already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /userfeedback:
    post:
      summary: User feedback
      description: Receives user feedback
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FeedbackRequest'
      responses:
        '201':
          description: Feedback received successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Bad request - missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /user/preferences:
    get:
      summary: Get user preferences
      description: Retrieves a list of user preferences
      security:
        - BearerAuth: [ ]
      responses:
        '200':
          description: List of user preferences
          content:
            application/json:
              schema:
                type: object
                properties:
                  dietary_requirements:
                    type: array
                    items:
                      $ref: '#/components/schemas/IDNamePair'
                  allergies:
                    type: array
                    items:
                      $ref: '#/components/schemas/IDNamePair'
                  cuisines:
                    type: array
                    items:
                      $ref: '#/components/schemas/IDNamePair'
                  dislikes:
                    type: array
                    items:
                      $ref: '#/components/schemas/IDNamePair'
                  health_conditions:
                    type: array
                    items:
                      $ref: '#/components/schemas/IDNamePair'
                  spice_levels:
                    type: array
                    items:
                      $ref: '#/components/schemas/IDNamePair'
                  cooking_methods:
                    type: array
                    items:
                      $ref: '#/components/schemas/IDNamePair'
              examples:
                userPreferences:
                  value:
                    dietary_requirements:
                      - id: 1
                        name: "Vegetarian"
                    allergies:
                      - id: 1
                        name: "Peanuts"
                    cuisines:
                      - id: 2
                        name: "French"
                      - id: 5
                        name: "Italian"
                    dislikes:
                      - id: 4
                        name: "Chicken Thigh Fillets"
                    health_conditions: [ ]
                    spice_levels:
                      - id: 1
                        name: "Mild"
                      - id: 2
                        name: "Medium"
                    cooking_methods:
                      - id: 1
                        name: "Bake"
                      - id: 4
                        name: "Grill"
        '400':
          description: User ID is required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: User preferences not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      summary: Update user preferences
      description: Updates the user's preferences
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                dietary_requirements:
                  type: array
                  items:
                    type: integer
                allergies:
                  type: array
                  items:
                    type: integer
                cuisines:
                  type: array
                  items:
                    type: integer
                dislikes:
                  type: array
                  items:
                    type: integer
                health_conditions:
                  type: array
                  items:
                    type: integer
                spice_levels:
                  type: array
                  items:
                    type: integer
                cooking_methods:
                  type: array
                  items:
                    type: integer
            example:
              dietary_requirements: [ 1, 2, 4 ]
              allergies: [ 1 ]
              cuisines: [ 2, 5 ]
              dislikes: [ 4 ]
              health_conditions: [ ]
              spice_levels: [ 1, 2 ]
              cooking_methods: [ 1, 4, 5 ]
      responses:
        '204':
          description: User preferences updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: User ID is required or Request body is required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /userprofile:
    get:
     summary: Get user profile
     description: |
       - Normal users can only fetch their own profile.  
       - Admins can fetch any profile using `?email=xxx`.
     security:
       - BearerAuth: []
     parameters:
       - in: query
         name: email
         schema:
           type: string
         required: false
         description: (Admin only) Email of the user whose profile to fetch
     responses:
       '200':
         description: User profile fetched successfully
         content:
           application/json:
             schema:
               $ref: '#/components/schemas/UserProfileResponse'
       '400':
         description: Email is required
         content:
           application/json:
             schema:
               $ref: '#/components/schemas/ErrorResponse'
       '500':
         description: Internal server error
         content:
           application/json:
             schema:
               $ref: '#/components/schemas/ErrorResponse'
  put:
     summary: Update user profile
     description: |
       - Normal users can update only their own profile.  
       - Admins can update any profile using `email`.
     security:
       - BearerAuth: []
     requestBody:
       required: true
       content:
         application/json:
           schema:
             $ref: '#/components/schemas/UserUpdateRequest'
     responses:
       '204':
         description: User profile updated successfully
         content:
           application/json:
             schema:
               $ref: '#/components/schemas/SuccessResponse'
       '400':
         description: Email is required or invalid request body
         content:
           application/json:
             schema:
               $ref: '#/components/schemas/ErrorResponse'
       '500':
         description: Internal server error
         content:
           application/json:
             schema:
               $ref: '#/components/schemas/ErrorResponse'
  /notifications:
    post:
      summary: Create a new notification
      description: Allows admin to create notifications
      security:
        - BearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: integer
                  description: Unique identifier of the user.
                type:
                  type: string
                  description: Type of notification (e.g., Email, Server, Phone).
                content:
                  type: string
                  description: Content of the notification.
              required:
                - user_id
                - type
                - content
            example:
              user_id: 123
              type: "Email"
              content: "This is a test notification"
      responses:
        201:
          description: Notification created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  notification:
                    type: object
                    properties:
                      simple_id:
                        type: integer
                      user_id:
                        type: integer
                      type:
                        type: string
                      content:
                        type: string
                      status:
                        type: string
                      timestamp:
                        type: string
                        format: date-time
        400:
          description: Bad Request - Missing required fields
        500:
          description: Internal Server Error

  /notifications/{user_id}:
    get:
      summary: Get all notifications for a specific user
      description: Users can only view their own notifications. Admin can view any.
      security:
        - BearerAuth: [ ]
      parameters:
        - in: path
          name: user_id
          required: true
          schema:
            type: integer
          description: Unique identifier of the user.
      responses:
        200:
          description: List of notifications for the user
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    simple_id:
                      type: integer
                    user_id:
                      type: integer
                    type:
                      type: string
                    content:
                      type: string
                    status:
                      type: string
                    timestamp:
                      type: string
                      format: date-time
        404:
          description: No notifications found for the user
        500:
          description: Internal Server Error

  /notifications/{simple_id}:
    delete:
      summary: Delete a specific notification by simple ID
      description: Only admin can delete a notification
      security:
        - BearerAuth: [ ]
      parameters:
        - in: path
          name: simple_id
          required: true
          schema:
            type: integer
          description: Simple identifier (integer) of the notification.
      responses:
        200:
          description: Notification deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Notification deleted successfully"
        404:
          description: Notification not found
        500:
          description: Internal Server Error

    put:
      summary: Update notification status by simple ID
      description: Admin or nutritionist can update notification status
      security:
        - BearerAuth: [ ]
      parameters:
        - in: path
          name: simple_id
          required: true
          schema:
            type: integer
          description: Simple identifier (integer) of the notification.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  description: New status for the notification (e.g., "read" or "unread").
              required:
                - status
            example:
              status: "read"
      responses:
        200:
          description: Notification updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  notification:
                    type: object
                    properties:
                      simple_id:
                        type: integer
                      user_id:
                        type: integer
                      type:
                        type: string
                      content:
                        type: string
                      status:
                        type: string
                      timestamp:
                        type: string
                        format: date-time
        404:
          description: Notification not found
        500:
          description: Internal Server Error
  /substitution/ingredient/{ingredientId}:
    get:
      summary: Get ingredient substitutions
      description: Retrieves substitution options for a specific ingredient, with optional filtering by allergies, dietary requirements, and health conditions.
      parameters:
        - name: ingredientId
          in: path
          required: true
          description: ID of the ingredient to find substitutions for
          schema:
            type: integer
        - name: allergies
          in: query
          required: false
          description: List of allergy IDs to exclude from substitutions. Pass as a comma-separated string.
          schema:
            type: string
            example: "2,3"
        - name: dietaryRequirements
          in: query
          required: false
          description: List of dietary requirement IDs to filter substitutions by. Pass as a comma-separated string.
          schema:
            type: string
            example: "1,4"
        - name: healthConditions
          in: query
          required: false
          description: List of health condition IDs to consider for substitutions. Pass as a comma-separated string.
          schema:
            type: string
            example: "2,5"
      responses:
        '200':
          description: Substitution options retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IngredientSubstitutionResponse'
        '400':
          description: Bad request - missing ingredient ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Ingredient not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /filter:
    get:
      summary: Filter recipes
      description: Retrieve recipes filtered by dietary preferences and allergens.
      tags:
        - Recipes
      parameters:
        - name: allergies
          in: query
          description: List of allergens to exclude from the recipes. Pass as a comma-separated string or array.
          required: false
          schema:
            type: string
            example: Peanut,Soy
        - name: dietary
          in: query
          description: Dietary preference to filter by (e.g., vegan, vegetarian).
          required: false
          schema:
            type: string
            example: vegan
        - name: include_details
          in: query
          required: false
          description: Whether to include full relationship details
          schema:
            type: string
            enum: [true, false]
            default: true
      responses:
        '200':
          description: Filtered recipes
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      description: Recipe ID
                      example: 1
                    name:
                      type: string
                      description: Name of the recipe
                      example: Vegan Salad
                    recipe_ingredients:
                      type: array
                      description: Ingredients used in the recipe
                      items:
                        type: object
                        properties:
                          ingredient_id:
                            type: integer
                            description: ID of the ingredient
                            example: 3
                          ingredients:
                            type: object
                            properties:
                              name:
                                type: string
                                description: Name of the ingredient
                                example: Lettuce
                              allergen:
                                type: string
                                description: Allergen associated with the ingredient
                                example: null
                              dietary_flag:
                                type: string
                                description: Dietary classification of the ingredient
                                example: vegan
        '400':
          description: Error in filtering recipes
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message
                    example: "Allergy type not found"    

  /auth/log-login-attempt:
    post:
      summary: Log a login attempt
      description: Records a login attempt in the auth_logs table with email, user ID (optional), IP, timestamp, and success status.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginLog'
      responses:
        '201':
          description: Login attempt logged successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Bad request - missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /recipe/cost/{recipe_id}:
    get:
      summary: Calculate estimated cost for a recipe
      description: Returns JSON object containing estimated cost information and corresponding ingredients price
      parameters:
        - name: recipe_id
          in: path
          required: true
          schema:
            type: integer
          description: Integer ID of the recipe for cost calculation
        - name: exclude_ids
          in: query
          required: false
          schema:
            type: string
          description: List of ingredient ids to be excluded, separated by commas
        - name: desired_servings
          in: query
          required: false
          schema:
            type: integer
          description: Number of serving would like to scale
      responses:
        '200':
          description: Calculate cost successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EstimatedCost'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /health-news:
    get:
      summary: Calculate estimated cost for a recipe
      description: Returns JSON array containing total cost and corresponding ingredients price
      summary: Unified Health News API
      description: Comprehensive API for health news management with multiple actions and flexible filtering
      parameters:
        - in: path
          name: recipe_id
          required: true
        - name: action
          in: query
          required: false
          description: |
            Action to perform (optional - API will auto-detect based on provided parameters):
              - "filter" (default): Filter health news articles using flexible criteria
              - "getById": Get specific health news by ID (requires id parameter)
              - "getByCategory": Get news by category (requires categoryId parameter)
              - "getByAuthor": Get news by author (requires authorId parameter)
              - "getByTag": Get news by tag (requires tagId parameter)
              - "getAllCategories": Get all categories
              - "getAllAuthors": Get all authors
              - "getAllTags": Get all tags
          schema:
            type: string
            enum: [filter, getAll, getById, getByCategory, getByAuthor, getByTag, getAllCategories, getAllAuthors, getAllTags]
            default: filter
        - name: id
          in: query
          required: false
          description: Health news ID
          schema:
            type: string
            format: uuid
        - name: categoryId
          in: query
          required: false
          description: Category ID
          schema:
            type: string
            format: uuid
        - name: authorId
          in: query
          required: false
          description: Author ID
          schema:
            type: string
            format: uuid
        - name: tagId
          in: query
          required: false
          description: Tag ID
          schema:
            type: string
            format: uuid
        - name: title
          in: query
          required: false
          description: Filter news by title (partial match)
          schema:
            type: string
        - name: content
          in: query
          required: false
          description: Filter news by content (partial match)
          schema:
            type: string
        - name: author_name
          in: query
          required: false
          description: Filter news by author name (partial match)
          schema:
            type: string
        - name: category_name
          in: query
          required: false
          description: Filter news by category name (partial match)
          schema:
            type: string
        - name: tag_name
          in: query
          required: false
          description: Filter news by tag name (partial match)
          schema:
            type: string
        - name: start_date
          in: query
          required: false
          description: Filter news published on or after this date (ISO format)
          schema:
            type: string
            format: date-time
        - name: end_date
          in: query
          required: false
          description: Filter news published on or before this date (ISO format)
          schema:
            type: string
            format: date-time
        - name: sort_by
          in: query
          required: false
          description: Field to sort by
          schema:
            type: string
            default: published_at
        - name: sort_order
          in: query
          required: false
          description: Sort order
          schema:
            type: string
            enum: [asc, desc]
            default: desc
        - name: limit
          in: query
          required: false
          description: Number of records to return
          schema:
            type: integer
          description: Integer ID of the recipe for cost calculation
            default: 20
        - name: page
          in: query
          required: false
          description: Page number for pagination
          schema:
            type: integer
            default: 1
        - name: include_details
          in: query
          required: false
          description: Whether to include full relationship details
          schema:
            type: string
            enum: [true, false]
            default: true
      responses:
        '200':
          description: Calculate cost successfully
          description: Successfully retrieved requested data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EstimatedCost'
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    oneOf:
                      - type: array
                        items:
                          $ref: '#/components/schemas/HealthNews'
                      - $ref: '#/components/schemas/HealthNews'
                      - type: array
                        items:
                          $ref: '#/components/schemas/Category'
                      - type: array
                        items:
                          $ref: '#/components/schemas/Author'
                      - type: array
                        items:
                          $ref: '#/components/schemas/Tag'
                  pagination:
                    type: object
                    properties:
                      total:
                        type: integer
                        example: 48
                      page:
                        type: integer
                        example: 1
                      limit:
                        type: integer
                        example: 20
                      total_pages:
                        type: integer
                        example: 3
    post:
      summary: Unified Health News Creation API
      description: Create health news articles and related entities
      parameters:
        - name: action
          in: query
          required: false
          description: |
            Action to perform:
              - "createNews" (default): Create a new health news article
              - "createCategory": Create a new category
              - "createAuthor": Create a new author
              - "createTag": Create a new tag
          schema:
            type: string
            enum: [createNews, createCategory, createAuthor, createTag]
            default: createNews
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - type: object
                  properties:
                    title:
                      type: string
                      example: "Diet and Health: How to Plan Your Daily Meals"
                    summary:
                      type: string
                      example: "This article explains how to maintain health through proper meal planning"
                    content:
                      type: string
                      example: "Proper eating habits are essential for health."
                    author_id:
                      type: string
                      format: uuid
                      example: "123e4567-e89b-12d3-a456-426614174001"
                    category_id:
                      type: string
                      format: uuid
                      example: "123e4567-e89b-12d3-a456-426614174003"
                  required:
                    - title
                    - content
                - type: object
                  properties:
                    name:
                      type: string
                      example: "Nutrition"
                    description:
                      type: string
                      example: "Articles about food nutrition"
                  required:
                    - name
                - type: object
                  properties:
                    name:
                      type: string
                      example: "Dr. Smith"
                    bio:
                      type: string
                      example: "Nutrition expert with 20 years of experience"
                  required:
                    - name
                - type: object
                  properties:
                    name:
                      type: string
                      example: "Weight Loss"
                  required:
                    - name
      responses:
        '201':
          description: Resource created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "123e4567-e89b-12d3-a456-426614174000"
                      title:
                        type: string
                        example: "Diet and Health: How to Plan Your Daily Meals"
    put:
      summary: Update Health News
      description: Update health news articles
      parameters:
        - name: id
          in: query
          required: true
          description: Health news ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  example: "Diet and Health: How to Plan Your Daily Meals (Updated)"
                summary:
                  type: string
                  example: "This article explains how to maintain health through proper meal planning"
      responses:
        '200':
          description: Health news updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/HealthNews'
        '400':
          description: Bad request - missing required parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Health news not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: Delete Health News
      description: Delete health news articles
      parameters:
        - name: id
          in: query
          required: true
          description: Health news ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Health news deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Health news successfully deleted
        '400':
          description: Bad request - missing required parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Health news not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /recipe/nutritionlog:
    get:
      summary: Get full nutrition info for a recipe by name
      description: Returns nutritional values of a recipe based on recipe_name
      parameters:
        - in: query
          name: name
          schema:
            type: string
          required: true
          description: The name of the recipe to search (case-insensitive)
      responses:
        '200':
          description: Nutritional info returned successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  recipe_name:
                    type: string
                  calories:
                    type: number
                  fat:
                    type: number
                  carbohydrates:
                    type: number
                  protein:
                    type: number
                  fiber:
                    type: number
                  vitamin_a:
                    type: number
                  vitamin_b:
                    type: number
                  vitamin_c:
                    type: number
                  vitamin_d:
                    type: number
                  sodium:
                    type: number
                  sugar:
                    type: number
        '400':
          description: Missing recipe name query parameter
        '404':
          description: Recipe not found
        '500':
          description: Internal server error                  
  
  /healthArticles:
    get:
      summary: Search health articles
      description: |
        Search for health articles based on query string. The search is performed across article titles, tags, and content.
        Results can be paginated, sorted, and filtered.
      parameters:
        - name: query
          in: query
          required: true
          description: Search query string
          schema:
            type: string
        - name: page
          in: query
          required: false
          description: 
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          required: false
          description: 
          schema:
            type: integer
            minimum: 1
            default: 10
        - name: sortBy
          in: query
          required: false
          description: 
          schema:
            type: string
            enum: [created_at, title, views]
            default: created_at
        - name: sortOrder
          in: query
          required: false
          description: Sort order (asc or desc)
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: Successful search
          
  /water-intake:
    post:
      summary: Update the number of glasses of water consumed
      description: Updates the user's daily water intake by adding the number of glasses consumed.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: string
                  format: uuid
                  description: The unique ID of the user
                glasses_consumed:
                  type: integer
                  description: Number of glasses consumed
              required:
                - user_id
                - glasses_consumed
            example:
              user_id: "15"
              glasses_consumed: 5
      responses:
        '200':
          description: Water intake updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Water intake updated successfully"
                  data:
                    type: object
                    properties:
                      user_id:
                        type: string
                        example: "15"
                      date:
                        type: string
                        format: date
                        example: "2025-05-10"
                      glasses_consumed:
                        type: integer
                        example: 5
                      updated_at:
                        type: string
                        format: date-time
                        example: "2025-05-10T12:00:00Z"
        '400':
          description: Bad request - missing or invalid fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /chatbot/history:
    post:
      summary: Get chat history
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserIdRequest'
      responses:
        '200':
          description: Chat history retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatHistoryResponse'
        '500':
          description: Internal server error

    delete:
      summary: Clear chat history
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserIdRequest'
      responses:
        '200':
          description: Chat history cleared successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericSuccessResponse'
        '500':
          description: Internal server error

  /medical-report/retrieve:
    post:
      summary: Predict obesity level and diabetes risks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MedicalReportRequest'
      responses:
        '200':
          description: Obesity level and diabetes risk result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MedicalReportResponse'
        '400':
          description: Bad Request - Invalid input data.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - Authentication credentials missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal Server Error - Something went wrong on the server.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /medical-report/plan:
    post:
      summary: Generate a 4-week health plan from a medical report
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HealthPlanRequest'
            examples:
              fe_combined_payload:
                value:
                  medical_report:
                    - obesity_prediction:
                        obesity_level: Overweight_Level_II
                        confidence: 79.8
                      diabetes_prediction:
                        diabetes: true
                        confidence: 79.8
                  survey_data:
                    Gender: Male
                    Age: 24
                    Height: 1.699998
                    Weight: 81.66995
                    Any family history of overweight (yes/no): "yes"
                    Frequent High Calorie Food Consumption (yes/no): "yes"
                    Consumption of vegetables in meals: 2.7
                    Consumption of Food Between Meals: Sometimes
                    Number of Main Meals: 3
                    Daily Water Intake: 2.763573
                    Do you Smoke?: "no"
                    Do you monitor your daily calories?: "no"
                    Physical Activity Frequency: 0
                    Time Using Technology Devices Daily: 0.976473
                    Alcohol Consumption Rate: Sometimes
                    Mode of Transportation you use: Public_Transportation
                    target_weight: 80
                    days_per_week: 4
                    workout_place: gym
              minimal:
                value:
                  medical_report:
                    - obesity_prediction:
                        obesity_level: Overweight_Level_I
                        confidence: 82.3
                      diabetes_prediction:
                        diabetes: false
                        confidence: 91.2
                  survey_data:
                    Gender: Male
                    Age: 29
                    Height: 1.78
                    Weight: 78.5
                    days_per_week: 4
                    workout_place: gym
      responses:
        '200':
          description: Weekly plan generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthPlanResponse'
        '400':
          description: Bad Request â invalid or missing input fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized â Authentication credentials missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '502':
          description: AI server error â upstream FastAPI returned an error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal Server Error â Something went wrong on the server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    
  /auth/register:
      post:
        tags:
          - Authentication
        summary: User Registration
        description: Create a new user account
        requestBody:
          required: true
          content:
            application/json:
              schema:
                type: object
                required:
                  - name
                  - email
                  - password
                properties:
                  name:
                    type: string
                    example: "John Doe"
                  email:
                    type: string
                    format: email
                    example: "john@nutrihelp.com"
                  password:
                    type: string
                    minLength: 6
                    example: "SecurePassword123!"
                  first_name:
                    type: string
                    example: "John"
                  last_name:
                    type: string
                    example: "Doe"
        responses:
          '201':
            description: Registration successful
          '400':
            description: Registration failed
  /auth/login:
    post:
      tags:
        - Authentication
      summary: User Login
      description: Login user and get access/refresh tokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 677
                      email:
                        type: string
                        example: "john@nutrihelp.com"
                      name:
                        type: string
                        example: "John Doe"
                      role:
                        type: string
                        example: "user"
                  accessToken:
                    type: string
                    description: "Access token (15 minutes validity)"
                    example: "eyJhbGciOiJIUzI1NiIs..."
                  refreshToken:
                    type: string
                    description: "Refresh token (7 days validity)"
                    example: "b9b1f1235fb056bc4389..."
                  expiresIn:
                    type: integer
                    description: "Token expiry time in seconds"
                    example: 900
                  tokenType:
                    type: string
                    example: "Bearer"
        '401':
          description: Login failed
  /auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh Access Token
      description: Get new access token using refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
                  example: "b9b1f1235fb056bc4389..."
      responses:
        '200':
          description: Token refresh successful
        '401':
          description: Invalid or expired refresh token
  /auth/logout:
    post:
      tags:
        - Authentication
      summary: User Logout
      description: Invalidate refresh token and logout user
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                refreshToken:
                  type: string
                  example: "b9b1f1235fb056bc4389..."
      responses:
        '200':
          description: Logout successful
  /auth/profile:
    get:
      tags:
        - Authentication
      summary: Get User Profile
      description: Get current user information
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Profile retrieved successfully
        '401':
          description: Unauthorized
        '404':
          description: User not found
  /auth/health:
    get:
      tags:
        - Authentication
      summary: Auth Service Health Check
      description: Check if authentication service is running
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Auth service is running"
                  timestamp:
                    type: string
                    format: date-time
                    example: "2025-08-03T12:14:00.706Z"

  /barcode:
    post:
      summary: Detect user allergen from a given barcode
      description: Retrieve ingredients information from a given barcode and detect user's allergen ingredients
      parameters:
        - name: code
          in: query
          required: true
          schema:
            type: integer
          description: Barcode number for allergen detection
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: integer
                  description: The user ID
              required:
                - user_id
      responses:
        '200':
          description: Barcode scanning successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BarcodeAllergenDetection'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Community API Endpoints
  /community/posts:
    post:
      tags:
        - Community
      summary: Create a new community post
      description: Create a new post in the community with content, category, and optional tags
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommunityPostCreate'
      responses:
        '201':
          description: Post created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommunityPostResponse'
        '400':
          description: Bad request - validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      tags:
        - Community
      summary: Get community posts
      description: Retrieve community posts with filtering, pagination, and sorting options
      parameters:
        - name: page
          in: query
          required: false
          description: Page number for pagination
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          required: false
          description: Number of posts per page
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
        - name: category
          in: query
          required: false
          description: Filter by post category
          schema:
            type: string
            enum: [all, weight-loss, fitness, dietary-restrictions, meal-prep, nutrition-tips, success-story, recipe-share, motivation]
            default: all
        - name: search
          in: query
          required: false
          description: Search in post content and tags
          schema:
            type: string
            maxLength: 100
        - name: user_id
          in: query
          required: false
          description: Filter posts by specific user
          schema:
            type: integer
        - name: sort_by
          in: query
          required: false
          description: Sort field
          schema:
            type: string
            enum: [created_at, likes_count, comments_count]
            default: created_at
        - name: sort_order
          in: query
          required: false
          description: Sort order
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: Posts retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommunityPostsResponse'
        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /community/posts/{id}:
    get:
      tags:
        - Community
      summary: Get a single community post
      description: Retrieve a specific community post by ID
      parameters:
        - name: id
          in: path
          required: true
          description: Post ID
          schema:
            type: integer
      responses:
        '200':
          description: Post retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommunityPostResponse'
        '404':
          description: Post not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Community
      summary: Update a community post
      description: Update an existing community post
      parameters:
        - name: id
          in: path
          required: true
          description: Post ID
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommunityPostUpdate'
      responses:
        '200':
          description: Post updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommunityPostResponse'
        '400':
          description: Bad request - validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Post not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Community
      summary: Delete a community post
      description: Delete a community post by ID
      parameters:
        - name: id
          in: path
          required: true
          description: Post ID
          schema:
            type: integer
      responses:
        '200':
          description: Post deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: Post not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /community/stats:
    get:
      tags:
        - Community
      summary: Get community statistics
      description: Retrieve community statistics including total posts, members, and daily activity
      responses:
        '200':
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommunityStatsResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /community/comments:
    post:
      tags:
        - Community
      summary: Create a comment
      description: Add a comment to a community post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommunityCommentCreate'
      responses:
        '201':
          description: Comment created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommunityCommentResponse'
        '400':
          description: Bad request - validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /community/comments/{id}:
    put:
      tags:
        - Community
      summary: Update a comment
      description: Update an existing comment
      parameters:
        - name: id
          in: path
          required: true
          description: Comment ID
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommunityCommentUpdate'
      responses:
        '200':
          description: Comment updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommunityCommentResponse'
        '400':
          description: Bad request - validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Comment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Community
      summary: Delete a comment
      description: Delete a comment by ID
      parameters:
        - name: id
          in: path
          required: true
          description: Comment ID
          schema:
            type: integer
      responses:
        '200':
          description: Comment deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: Comment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /community/posts/{postId}/comments:
    get:
      tags:
        - Community
      summary: Get comments for a post
      description: Retrieve all comments for a specific post with pagination
      parameters:
        - name: postId
          in: path
          required: true
          description: Post ID
          schema:
            type: integer
        - name: page
          in: query
          required: false
          description: Page number for pagination
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          required: false
          description: Number of comments per page
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 20
      responses:
        '200':
          description: Comments retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommunityCommentsResponse'
        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /community/likes:
    post:
      tags:
        - Community
      summary: Like a post
      description: Add a like to a community post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommunityLikeRequest'
      responses:
        '200':
          description: Post liked successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommunityLikeResponse'
        '400':
          description: Bad request - validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Community
      summary: Unlike a post
      description: Remove a like from a community post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommunityLikeRequest'
      responses:
        '200':
          description: Post unliked successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Bad request - validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /community/users/{userId}/liked-posts:
    get:
      tags:
        - Community
      summary: Get user's liked posts
      description: Retrieve all posts liked by a specific user
      parameters:
        - name: userId
          in: path
          required: true
          description: User ID
          schema:
            type: integer
        - name: page
          in: query
          required: false
          description: Page number for pagination
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          required: false
          description: Number of posts per page
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 20
      responses:
        '200':
          description: Liked posts retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommunityPostsResponse'
        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /community/upload-image:
    post:
      tags:
        - Community
      summary: Upload community post image
      description: Upload an image for a community post
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
                  description: Image file
                user_id:
                  type: integer
                  description: User ID
      responses:
        '200':
          description: Image uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Image processed successfully"
                  data:
                    type: object
                    properties:
                      image_url:
                        type: string
                        example: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ..."
                      file_name:
                        type: string
                        example: "image.jpg"
                      file_size:
                        type: integer
                        example: 123456
        '400':
          description: Bad request - missing image or user_id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /community/shares:
    post:
      tags:
        - Community
      summary: Share a post
      description: Record a post share
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
                - post_id
              properties:
                user_id:
                  type: integer
                  description: User ID
                  example: 202
                post_id:
                  type: integer
                  description: Post ID
                  example: 7
                share_platform:
                  type: string
                  description: Share platform
                  example: "facebook"
                  default: "copy_link"
      responses:
        '201':
          description: Post shared successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Post shared successfully"
                  data:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      user_id:
                        type: integer
                        example: 202
                      post_id:
                        type: integer
                        example: 7
                      share_platform:
                        type: string
                        example: "facebook"
                      created_at:
                        type: string
                        format: date-time
                        example: "2025-09-12T07:47:18.693112+00:00"
        '400':
          description: Bad request - missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Post not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /community/posts/{postId}/shares:
    get:
      tags:
        - Community
      summary: Get share count for a post
      description: Get the number of shares for a specific post
      parameters:
        - name: postId
          in: path
          required: true
          description: Post ID
          schema:
            type: integer
      responses:
        '200':
          description: Share count retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      share_count:
                        type: integer
                        example: 5
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    AllergyCheckRequest:
      type: object
      required: [userAllergies, meal]
      properties:
        userAllergies:
          type: array
          description: List of allergens the user is sensitive to (lowercase recommended)
          items: { type: string }
          example: ["peanuts","milk","sesame"]
        meal:
          type: object
          required: [name, ingredients]
          properties:
            name:
              type: string
              example: "Chicken Satay"
            ingredients:
              type: array
              items: { type: string }
              example: ["chicken","peanut sauce","soy sauce","garlic"]

    AllergyCheckResponse:
      type: object
      properties:
        hasAllergens:
          type: boolean
          example: true
        triggers:
          type: array
          description: Which of the userAllergies were detected in the meal ingredients
          items: { type: string }
          example: ["peanuts","soy"]
    Kpi24h:
      type: object
      properties:
        login_events_24h: { type: integer, example: 512 }
        successes_24h:    { type: integer, example: 420 }
        failures_24h:     { type: integer, example: 92 }
        success_rate_24h: { type: number, format: float, example: 82.03 }
    DailyRow:
      type: object
      properties:
        day_local:        { type: string, format: date, example: '2025-08-26' }
        attempts:         { type: integer, example: 150 }
        successes:        { type: integer, example: 120 }
        failures:         { type: integer, example: 30 }
        success_rate_pct: { type: number, format: float, example: 80.0 }
    DauRow:
      type: object
      properties:
        day_local: { type: string, format: date, example: '2025-08-26' }
        dau:       { type: integer, example: 97 }
    FailingIpRow:
      type: object
      properties:
        ip_address:         { type: string, example: '127.0.0.1' }
        failed_count:       { type: integer, example: 120 }
        total_login_events: { type: integer, example: 150 }
        fail_pct:           { type: number, format: float, example: 80.0 }
    DomainFailRow:
      type: object
      properties:
        domain:           { type: string, example: 'deakin.edu.au' }
        failures_last_7d: { type: integer, example: 35 }
    LoginRequest:
      type: object
      properties:
        email:
          type: string
          example: test@email.com
        password:
          type: string
          example: test123
      required:
        - email
        - password
    SignupRequest:
      type: object
      properties:
        name:
          type: string
        email:
          type: string
        password:
          type: string
        contact_number:
          type: string
        address:
          type: string
      required:
        - name
        - email
        - password
        - contact_number
        - address
    LoginWithMFARequest:
      type: object
      properties:
        email:
          type: string
        password:
          type: string
          format: password
        mfa_token:
          type: string
      required:
        - email
        - password
        - mfa_token
    UserResponse:
      type: object
      properties:
        user_id:
          type: integer
        email:
          type: string
        password:
          type: string
        mfa_enabled:
          type: boolean
    UserUpdateRequest:
      type: object
      properties:
        username:
          type: string
        first_name:
          type: string
        last_name:
          type: string
        email:
          type: string
          format: email
        contact_number:
          type: string
    UserProfileResponse:
      type: object
      properties:
        user_id:
          type: integer
        name:
          type: string
        first_name:
          type: string
        last_name:
          type: string
        email:
          type: string
          format: email
        contact_number:
          type: string
        mfa_enabled:
          type: boolean
    JWTResponse:
      type: string
    ContactRequest:
      type: object
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        message:
          type: string
      required:
        - name
        - email
        - message
    FeedbackRequest:
      type: object
      properties:
        name:
          type: string
        contact_number:
          type: string
        email:
          type: string
          format: email
        experience:
          type: string
        message:
          type: string
      required:
        - name
        - contact_number
        - email
        - experience
        - message
    IDNamePair:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
    Appointment:
      type: object
      properties:
        userId:
          type: integer
        date:
          type: string
          format: date-time
        time:
          type: string
        description:
          type: string
    SuccessResponse:
      type: object
      properties:
        message:
          type: string
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
    Recipe:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        ingredients:
          type: array
          items:
            type: string
        cooking_method:
          type: string
        cuisine:
          type: string
        spice_level:
          type: string
        health_condition:
          type: string
        dietary_requirement:
          type: string
        allergy:
          type: string
        dislikes:
          type: string
    MealPlanRecipe:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
        details:
          type: object
          properties:
            calories:
              type: number
            fats:
              type: number
            proteins:
              type: number
            vitamins:
              type: number
            sodium:
              type: number
    CreateMealPlanRequest:
      type: object
      properties:
        id:
          type: integer
        meal_type:
          type: string
        recipes:
          type: array
          items:
            $ref: '#/components/schemas/MealPlanRecipe'
    MealPlanResponse:
      type: object
      properties:
        user_id:
          type: integer
        meal_type:
          type: string
        recipe_ids:
          type: array
          items:
            type: integer
                
    LoginLog:
      type: object
      properties:
        email:
          type: string
          example: user@example.com
        user_id:
          type: integer
          nullable: true
          example: 123
        success:
          type: boolean
          example: true
        ip_address:
          type: string
          example: "192.168.1.1"
        created_at:
          type: string
          format: date-time
          example: "2025-03-23T13:45:00Z"
      required:
        - email
        - success
        - ip_address
        - created_at

    EstimatedCost:
        type: object
        properties:
          info: 
            type: object
            properties:
              estimation_type:
                type: string
              include_all_wanted_ingredients:
                type: boolean
              minimum_cost:
                type: number
              maximum_cost:
                type: number
          low_cost:
            type: object
            properties:
              price:
                type: number
              count:
                type: number
              ingredients:
                type: array
                items:
                  type: object
                  properties:
                    ingredient_id: 
                      type: integer
                    product_name: 
                      type: string
                    quantity: 
                      type: string
                    purchase_quantity: 
                      type: integer
                    total_cost: 
                      type: number
          high_cost:
            type: object
            properties:
              price:
                type: number
              count:
                type: number
              ingredients:
                type: array
                items:
                  type: object
                  properties:
                    ingredient_id: 
                      type: integer
                    product_name: 
                      type: string
                    quantity: 
                      type: string
                    purchase_quantity: 
                      type: integer
                    total_cost: 
                      type: number

          minimum_cost:
            type: number
          maximum_cost:
            type: number
          include_all_ingredients:
            type: boolean
          low_cost_ingredients:
            type: array
            items:
              type: object
              properties:
                ingredient_id: 
                  type: integer
                product_name: 
                  type: string
                quantity: 
                  type: string
                purchase_quantity: 
                  type: integer
                total_cost: 
                  type: number
          high_cost_ingredients:
            type: array
            items:
              type: object
              properties:
                ingredient_id: 
                  type: integer
                product_name: 
                  type: string
                quantity: 
                  type: string
                purchase_quantity: 
                  type: integer
                total_cost: 
                  type: number

    HealthNews:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        title:
          type: string
          example: "Diet and Health: How to Plan Your Daily Meals"
        summary:
          type: string
          example: "This article explains how to maintain health through proper meal planning"
        author:
          type: object
          properties:
            name:
              type: string
              example: "Dr. Smith"
        category:
          type: object
          properties:
            name:
              type: string
              example: "Nutrition"
        image_url:
          type: string
          format: url
          example: "https://example.com/images/healthy-eating.jpg"
        published_at:
          type: string
          format: date-time
          example: "2023-09-15T10:30:00Z"

    HealthNewsCreateRequest:
      type: object
      properties:
        title:
          type: string
          example: "Diet and Health: How to Plan Your Daily Meals"
        summary:
          type: string
          example: "This article explains how to maintain health through proper meal planning"
        content:
          type: string
          example: "Proper eating habits are essential for health."
        author_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174001"
        category_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174003"
        image_url:
          type: string
          format: url
          example: "https://example.com/images/healthy-eating.jpg"

    HealthNewsUpdateRequest:
      type: object
      properties:
        title:
          type: string
          example: "Diet and Health: How to Plan Your Daily Meals (Updated)"
        summary:
          type: string
          example: "This article explains how to maintain health through proper meal planning"
        category_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174003"

    Author:
      type: object
      properties:
        name:
          type: string
          example: "Dr. Smith"
        bio:
          type: string
          example: "Nutrition expert with 20 years of experience"

    Source:
      type: object
      properties:
        name:
          type: string
          example: "Health Times"
        base_url:
          type: string
          format: url
          example: "https://health-news.com"

    Category:
      type: object
      properties:
        name:
          type: string
          example: "Nutrition"
        description:
          type: string
          example: "Articles about food nutrition"

    Tag:
      type: object
      properties:
        name:
          type: string
          example: "Weight Loss"

    # Chatbot-related Schemas
    ChatbotQueryRequest:
      type: object
      properties:
        user_id:
          type: integer
        user_input:
          type: string

    ChatbotQueryResponse:
      type: object
      properties:
        response_text:
          type: string
        # optional message field
        message:
          type: string

    ChatHistoryResponse:
      type: object
      properties:
        message:
          type: string
        chat_history:
          type: array
          items:
            type: object
            properties:
              user_input:
                type: string
              response_text:
                type: string
              timestamp:
                type: string
                format: date-time

    GenericSuccessResponse:
      type: object
      properties:
        message:
          type: string

    UserIdRequest:
      type: object
      properties:
        user_id:
          type: integer
    MedicalReportRequest:
      MedicalReportRequest:
      type: object
      required:
        - Gender
        - Age
        - Height
        - Weight
        - Any family history of overweight (yes/no)
        - Frequent High Calorie Food Consumption (yes/no)
        - Consumption of vegetables in meals
        - Consumption of Food Between Meals
        - Number of Main Meals
        - Daily Water Intake
        - Do you Smoke?
        - Do you monitor your daily calories?
        - Physical Activity Frequency
        - Time Using Technology Devices Daily
        - Alcohol Consumption Rate
        - Mode of Transportation you use
      properties:
        Gender:
          type: string
          description: Gender of the individual.
          example: "Male"
        Age:
          type: number
          format: int
          description: Age in years.
          example: 24
        Height:
          type: number
          format: float
          description: Height in meters.
          example: 1.699998
        Weight:
          type: number
          format: float
          description: Weight in kilograms.
          example: 81.66995
        Any family history of overweight (yes/no):
          type: string
          enum: ["yes", "no"]
          description: Indicates if there is a family history of being overweight.
          example: "yes"
        Frequent High Calorie Food Consumption (yes/no):
          type: string
          enum: ["yes", "no"]
          description: Indicates frequent consumption of high-calorie food.
          example: "yes"
        Consumption of vegetables in meals:
          type: number
          format: float
          description: Frequency of vegetable consumption in meals.
          example: 3
        Consumption of Food Between Meals:
          type: string
          enum: ["no", "Sometimes", "Frequently", "Always"]
          description: Frequency of consuming food between meals.
          example: "Sometimes"
        Number of Main Meals:
          type: number
          format: float
          description: Number of main meals per day.
          example: 3
        Daily Water Intake:
          type: number
          format: float
          description: Daily water intake in liters.
          example: 2.763573
        Do you Smoke?:
          type: string
          enum: ["yes", "no"]
          description: Indicates if the individual smokes.
          example: "no"
        Do you monitor your daily calories?:
          type: string
          enum: ["yes", "no"]
          description: Indicates if the person monitors their daily calorie intake.
          example: "no"
        Physical Activity Frequency:
          type: number
          format: float
          description: Frequency of physical activity per week.
          example: 0
        Time Using Technology Devices Daily:
          type: number
          format: float
          description: Time spent using technological devices daily (in hours).
          example: 0.976473
        Alcohol Consumption Rate:
          type: string
          enum: ["no", "never", "Sometimes", "Frequently", "Always"]
          description: Frequency of alcohol consumption.
          example: "Sometimes"
        Mode of Transportation you use:
          type: string
          enum: ["Car", "Motorbike", "Bike", "Public_Transportation", "Walking"]
          description: Common mode of transportation used.
          example: "Public_Transportation"

    MedicalReportResponse:
      type: object
      properties:
        medical_report:
          type: object
          description: Report containing obesity and diabetes predictions.
          properties:
            obesity_prediction:
              type: object
              properties:
                obesity_level:
                  type: string
                  description: Predicted obesity level.
                  example: "Obese"
            diabetes_prediction:
              type: object
              properties:
                diabetes:
                  type: boolean
                  description: Indicates if diabetes is predicted (true or false).
                  example: true
                confidence:
                  type: number
                  format: float
                  description: Model confidence score for diabetes prediction.
                  example: 0.798

    BarcodeAllergenDetection:
      type: object
      properties:
        productName:
          type: string
        detection_result:
          type: object
          properties:
            hasUserAllergen:
              type: boolean
            matchingAllergens:
              type: array
              items:
                type: string
        barcode_ingredients:
          type: array
          items:
            type: string
        user_allergen_ingredients:
          type: array
          items:
            type: string
            
    # Shopping List Schemas
    IngredientOption:
      type: object
      properties:
        id:
          type: integer
          description: Unique identifier for the ingredient option
          example: 1
        ingredient_id:
          type: integer
          description: Reference to the ingredient
          example: 15
        ingredient_name:
          type: string
          description: Name of the ingredient
          example: "Tomato"
        product_name:
          type: string
          description: Specific product name
          example: "Fresh Tomatoes"
        package_size:
          type: number
          format: float
          description: Size of the package
          example: 500
        unit:
          type: number
          format: float
          description: Unit quantity
          example: 500
        measurement:
          type: string
          description: Unit of measurement
          example: "g"
        price:
          type: number
          format: float
          description: Price of the product
          example: 3.99
        store:
          type: string
          description: Store name
          example: "Coles"
        store_location:
          type: string
          description: Store location
          example: "Melbourne CBD"

    ShoppingListItemInput:
      type: object
      required:
        - ingredient_name
        - quantity
        - unit
        - measurement
      properties:
        ingredient_id:
          type: integer
          description: Reference to the ingredient (optional)
          example: 15
        ingredient_name:
          type: string
          description: Name of the ingredient
          example: "Tomato"
        category:
          type: string
          description: Category of the ingredient
          example: "Vegetable"
        quantity:
          type: number
          format: float
          description: Quantity needed
          minimum: 0.01
          example: 500
        unit:
          type: number
          format: float
          description: Unit quantity
          example: 500
        measurement:
          type: string
          description: Unit of measurement
          example: "g"
        notes:
          type: string
          description: Additional notes
          example: "For salads"
        meal_tags:
          type: array
          description: Associated meal types
          items:
            type: string
          example: ["breakfast", "lunch"]
        estimated_cost:
          type: number
          format: float
          description: Estimated cost for this item
          example: 3.99

    ShoppingListItem:
      type: object
      properties:
        id:
          type: integer
          description: Unique identifier for the shopping list item
          example: 1
        shopping_list_id:
          type: integer
          description: Reference to the shopping list
          example: 1
        ingredient_id:
          type: integer
          description: Reference to the ingredient (nullable)
          example: 15
        ingredient_name:
          type: string
          description: Name of the ingredient
          example: "Tomato"
        category:
          type: string
          description: Category of the ingredient
          example: "Vegetable"
        quantity:
          type: number
          format: float
          description: Quantity needed
          example: 500
        unit:
          type: number
          format: float
          description: Unit quantity
          example: 500
        measurement:
          type: string
          description: Unit of measurement
          example: "g"
        notes:
          type: string
          description: Additional notes
          example: "For salads"
        purchased:
          type: boolean
          description: Whether the item has been purchased
          example: false
        meal_tags:
          type: array
          description: Associated meal types
          items:
            type: string
          example: ["breakfast", "lunch"]
        estimated_cost:
          type: number
          format: float
          description: Estimated cost for this item
          example: 3.99
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2024-01-15T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
          example: "2024-01-15T10:00:00Z"

    ShoppingList:
      type: object
      properties:
        id:
          type: integer
          description: Unique identifier for the shopping list
          example: 1
        user_id:
          type: integer
          description: Reference to the user
          example: 123
        name:
          type: string
          description: Name of the shopping list
          example: "Weekly Shopping List"
        description:
          type: string
          description: Description of the shopping list
          example: "Weekly groceries for meal plans"
        estimated_total_cost:
          type: number
          format: float
          description: Estimated total cost
          example: 45.67
        status:
          type: string
          description: Status of the shopping list
          example: "active"
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2024-01-15T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
          example: "2024-01-15T10:00:00Z"

    ShoppingListWithProgress:
      type: object
      allOf:
        - $ref: '#/components/schemas/ShoppingList'
        - type: object
          properties:
            items:
              type: array
              description: Array of shopping list items
              items:
                $ref: '#/components/schemas/ShoppingListItem'
            progress:
              type: object
              properties:
                total_items:
                  type: integer
                  description: Total number of items
                  example: 8
                purchased_items:
                  type: integer
                  description: Number of purchased items
                  example: 2
                completion_percentage:
                  type: integer
                  description: Completion percentage
                  example: 25

    ShoppingListFromMealPlan:
      type: object
      properties:
        shopping_list:
          type: array
          description: Array of shopping list items
          items:
            type: object
            properties:
              ingredient_id:
                type: integer
                description: Reference to the ingredient
                example: 15
              ingredient_name:
                type: string
                description: Name of the ingredient
                example: "Tomato"
              category:
                type: string
                description: Category of the ingredient
                example: "Vegetable"
              total_quantity:
                type: number
                format: float
                description: Total quantity needed
                example: 800
              unit:
                type: number
                format: float
                description: Unit quantity
                example: 800
              measurement:
                type: string
                description: Unit of measurement
                example: "g"
              meals:
                type: array
                description: Associated meal types
                items:
                  type: string
                example: ["breakfast", "lunch"]
              estimated_cost:
                type: object
                properties:
                  min:
                    type: number
                    format: float
                    description: Minimum estimated cost
                    example: 6.38
                  max:
                    type: number
                    format: float
                    description: Maximum estimated cost
                    example: 7.98
        summary:
          type: object
          properties:
            total_items:
              type: integer
              description: Total number of items
              example: 8
            total_estimated_cost:
              type: object
              properties:
                min:
                  type: number
                  format: float
                  description: Minimum total estimated cost
                  example: 45.67
                max:
                  type: number
                  format: float
                  description: Maximum total estimated cost
                  example: 58.92
            categories:
              type: array
              description: Array of ingredient categories
              items:
                type: string
              example: ["Vegetable", "Meat", "Dairy", "Pantry"]

    # Community API Schemas
    CommunityPostCreate:
      type: object
      required:
        - user_id
        - content
        - category
      properties:
        user_id:
          type: integer
          description: ID of the user creating the post
          example: 123
        content:
          type: string
          description: Post content
          minLength: 10
          maxLength: 2000
          example: "Just tried this amazing healthy recipe! The quinoa salad was perfect for my weight loss journey."
        category:
          type: string
          description: Post category
          enum: [weight-loss, fitness, dietary-restrictions, meal-prep, nutrition-tips, success-story, recipe-share, motivation]
          example: "success-story"
        tags:
          type: array
          description: Post tags
          items:
            type: string
            maxLength: 50
          maxItems: 10
          example: ["quinoa", "salad", "healthy", "weight-loss"]
        image_url:
          type: string
          format: uri
          description: Optional image URL
          example: "https://example.com/images/quinoa-salad.jpg"

    CommunityPostUpdate:
      type: object
      properties:
        content:
          type: string
          description: Updated post content
          minLength: 10
          maxLength: 2000
          example: "Updated: The quinoa salad recipe was even better with added avocado!"
        category:
          type: string
          description: Updated post category
          enum: [weight-loss, fitness, dietary-restrictions, meal-prep, nutrition-tips, success-story, recipe-share, motivation]
          example: "recipe-share"
        tags:
          type: array
          description: Updated post tags
          items:
            type: string
            maxLength: 50
          maxItems: 10
          example: ["quinoa", "salad", "healthy", "avocado", "recipe"]
        image_url:
          type: string
          format: uri
          description: Updated image URL
          example: "https://example.com/images/updated-quinoa-salad.jpg"

    CommunityUser:
      type: object
      properties:
        user_id:
          type: integer
          description: User ID
          example: 123
        username:
          type: string
          description: Username
          example: "healthyliving_user"
        email:
          type: string
          format: email
          description: User email
          example: "user@example.com"
        profile_picture:
          type: string
          format: uri
          description: Profile picture URL
          example: "https://example.com/avatars/user123.jpg"
        verified:
          type: boolean
          description: Whether the user is verified
          example: true

    CommunityPost:
      type: object
      properties:
        id:
          type: integer
          description: Post ID
          example: 1
        user_id:
          type: integer
          description: User ID who created the post
          example: 123
        content:
          type: string
          description: Post content
          example: "Just tried this amazing healthy recipe! The quinoa salad was perfect for my weight loss journey."
        category:
          type: string
          description: Post category
          example: "success-story"
        tags:
          type: array
          description: Post tags
          items:
            type: string
          example: ["quinoa", "salad", "healthy", "weight-loss"]
        image_url:
          type: string
          format: uri
          description: Image URL
          example: "https://example.com/images/quinoa-salad.jpg"
        likes_count:
          type: integer
          description: Number of likes
          example: 15
        comments_count:
          type: integer
          description: Number of comments
          example: 8
        shares_count:
          type: integer
          description: Number of shares
          example: 3
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2024-01-15T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
          example: "2024-01-15T10:30:00Z"
        users:
          $ref: '#/components/schemas/CommunityUser'

    CommunityPostResponse:
      type: object
      properties:
        statusCode:
          type: integer
          example: 200
        message:
          type: string
          example: "Post retrieved successfully"
        data:
          $ref: '#/components/schemas/CommunityPost'

    CommunityPostsResponse:
      type: object
      properties:
        statusCode:
          type: integer
          example: 200
        message:
          type: string
          example: "Posts retrieved successfully"
        data:
          type: array
          items:
            $ref: '#/components/schemas/CommunityPost'
        pagination:
          type: object
          properties:
            page:
              type: integer
              example: 1
            limit:
              type: integer
              example: 10
            total:
              type: integer
              example: 25

    CommunityCommentCreate:
      type: object
      required:
        - user_id
        - post_id
        - content
      properties:
        user_id:
          type: integer
          description: ID of the user creating the comment
          example: 456
        post_id:
          type: integer
          description: ID of the post being commented on
          example: 1
        content:
          type: string
          description: Comment content
          minLength: 1
          maxLength: 500
          example: "This looks amazing! Can you share the recipe?"

    CommunityCommentUpdate:
      type: object
      required:
        - content
      properties:
        content:
          type: string
          description: Updated comment content
          minLength: 1
          maxLength: 500
          example: "Updated: This looks amazing! Can you share the recipe? I'd love to try it this weekend."

    CommunityComment:
      type: object
      properties:
        id:
          type: integer
          description: Comment ID
          example: 1
        user_id:
          type: integer
          description: User ID who created the comment
          example: 456
        post_id:
          type: integer
          description: Post ID being commented on
          example: 1
        content:
          type: string
          description: Comment content
          example: "This looks amazing! Can you share the recipe?"
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2024-01-15T11:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
          example: "2024-01-15T11:00:00Z"
        users:
          $ref: '#/components/schemas/CommunityUser'

    CommunityCommentResponse:
      type: object
      properties:
        statusCode:
          type: integer
          example: 201
        message:
          type: string
          example: "Comment created successfully"
        data:
          $ref: '#/components/schemas/CommunityComment'

    CommunityCommentsResponse:
      type: object
      properties:
        statusCode:
          type: integer
          example: 200
        message:
          type: string
          example: "Comments retrieved successfully"
        data:
          type: array
          items:
            $ref: '#/components/schemas/CommunityComment'
        pagination:
          type: object
          properties:
            page:
              type: integer
              example: 1
            limit:
              type: integer
              example: 20
            total:
              type: integer
              example: 8

    CommunityLikeRequest:
      type: object
      required:
        - user_id
        - post_id
      properties:
        user_id:
          type: integer
          description: ID of the user liking the post
          example: 789
        post_id:
          type: integer
          description: ID of the post being liked
          example: 1

    CommunityLikeResponse:
      type: object
      properties:
        statusCode:
          type: integer
          example: 200
        message:
          type: string
          example: "Post liked successfully"
        data:
          type: object
          properties:
            user_id:
              type: integer
              example: 789
            post_id:
              type: integer
              example: 1
            already_liked:
              type: boolean
              example: false

    CommunityStatsResponse:
      type: object
      properties:
        statusCode:
          type: integer
          example: 200
        message:
          type: string
          example: "Community statistics retrieved successfully"
        data:
          type: object
          properties:
            total_posts:
              type: integer
              description: Total number of posts
              example: 1250
            total_members:
              type: integer
              description: Total number of community members
              example: 850
            posts_today:
              type: integer
              description: Number of posts created today
              example: 15
